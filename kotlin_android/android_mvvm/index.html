<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">

    
<link rel="stylesheet" href="/blog-theme/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/blog-theme/css/global.css">

    
<link rel="stylesheet" href="/blog-theme/css/article.css">

    
    
<script src="/blog-theme/bootstrap/js/bootstrap.bundle.min.js"></script>


    <title>
        I&#39;m prime
    </title>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="bg-dark">
    <header>
    <nav class="navbar navbar-expand navbar-expand-lg navbar-dark sticky-top shadow">
        <div class="container-fluid">
            <a class="navbar-brand" href="/blog-theme/">

                

            I&#39;m prime
            </a>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                <ul class="navbar-nav">

                    

                        <li class="nav-item">
                            <a class="nav-link " aria-current="page"
                                href="/blog-theme/">
                                主页
                            </a>
                        </li>

                    

                        <li class="nav-item">
                            <a class="nav-link " aria-current="page"
                                href="/blog-theme/archives/">
                                归档
                            </a>
                        </li>

                    

                </ul>
            </div>
        </div>
    </nav>
</header>
    <div class="container-fluid mt-md-5">
    <div class="row">
        <div class="col"></div>
        <div class="col-12 col-sm-10 col-md-8 col-lg-7 col-xl-5 shadow-lg">
            <div class="container-fluid mt-5 text-center">
                <h1 class="text-white">
                    android mvvm架构
                </h1>
                <p class="mt-2 text-secondary">
                    2020.10.23
                </p>
            </div>

            <article class="container-fluid text-white">
                <h2 id="kotlin-amp-android-笔记"><a href="#kotlin-amp-android-笔记" class="headerlink" title="kotlin &amp; android 笔记"></a><a href="https://lzyprime.github.io/kotlin_android/kotlin_android">kotlin &amp; android 笔记</a></h2><hr>
<h2 id="λ："><a href="#λ：" class="headerlink" title="λ："></a>λ：</h2><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/jetpack/guide">官网_应用架构指南-MVVM</a></li>
</ul>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># android mvvm demo</span></span><br><span class="line"><span class="comment"># 仓库地址: https://github.com/lzyprime/android_demos</span></span><br><span class="line"><span class="comment"># branch: mvvm</span></span><br><span class="line"></span><br><span class="line">git <span class="built_in">clone</span> -b mvvm https://github.com/lzyprime/android_demos</span><br></pre></td></tr></table></figure>

<h2 id="添加组件"><a href="#添加组件" class="headerlink" title="添加组件"></a>添加组件</h2><h3 id="网络：Retrofit-kotlin-协程"><a href="#网络：Retrofit-kotlin-协程" class="headerlink" title="网络：Retrofit + kotlin 协程"></a>网络：Retrofit + kotlin 协程</h3><p>我也试过其他框架：<a target="_blank" rel="noopener" href="https://github.com/kittinunf/fuel">Fuel</a>, <a target="_blank" rel="noopener" href="https://ktor.kotlincn.net/clients/index.html">Ktor Client</a>。但是迫于业务需求，最后保留了Retrofit。如果网络请求比较简单，可以试试这两个框架，由<code>kotlin</code>实现，和协程配合更好。</p>
<blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://square.github.io/retrofit/">Retrofit 官网</a></li>
<li><a target="_blank" rel="noopener" href="https://www.kotlincn.net/docs/reference/coroutines/coroutines-guide.html">kotlin 协程</a></li>
</ul>
</blockquote>
<h3 id="lifecycle-ktx：ViewModel-LiveData"><a href="#lifecycle-ktx：ViewModel-LiveData" class="headerlink" title="lifecycle ktx：ViewModel, LiveData"></a>lifecycle ktx：ViewModel, LiveData</h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/lifecycle?hl=zh_cn">生命周期处理</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/jetpack/androidx/releases/lifecycle?hl=zh_cn#declaring_dependencies">Lifecycle</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/viewmodel?hl=zh_cn">ViewModel</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/livedata">LiveData</a></li>
</ul>
</blockquote>
<ul>
<li>androidx.lifecycle:lifecycle-runtime-ktx</li>
<li>androidx.lifecycle:lifecycle-livedata-ktx</li>
<li>androidx.lifecycle:lifecycle-viewmodel-ktx</li>
<li>androidx.activity:activity-ktx</li>
</ul>
<p>其中<code>activity-ktx</code>目的：</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="comment">// Create a ViewModel the first time the system calls an activity&#x27;s onCreate() method.</span></span><br><span class="line">        <span class="comment">// Re-created activities receive the same MyViewModel instance created by the first activity.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Use the &#x27;by viewModels()&#x27; Kotlin property delegate</span></span><br><span class="line">        <span class="comment">// from the activity-ktx artifact</span></span><br><span class="line">        <span class="keyword">val</span> model: MyViewModel <span class="keyword">by</span> viewModels()</span><br><span class="line">        model.getUsers().observe(<span class="keyword">this</span>, Observer&lt;List&lt;User&gt;&gt;&#123; users -&gt;</span><br><span class="line">            <span class="comment">// update UI</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="依赖注入：Hlit"><a href="#依赖注入：Hlit" class="headerlink" title="依赖注入：Hlit"></a>依赖注入：Hlit</h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection">Hilt</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection/manual">依赖注入原理</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/training/dependency-injection/hilt-jetpack">Hilt 和 Jetpack集成</a></li>
</ul>
</blockquote>
<h3 id="数据库：Room"><a href="#数据库：Room" class="headerlink" title="数据库：Room"></a>数据库：Room</h3><blockquote>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.android.google.cn/topic/libraries/architecture/room">Room</a> (暂时没需求)</li>
</ul>
</blockquote>
<h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><h3 id="0-init"><a href="#0-init" class="headerlink" title="0. init"></a>0. init</h3><h4 id="NetUtil"><a href="#NetUtil" class="headerlink" title="NetUtil"></a>NetUtil</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 网络请求工具</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// utils/Net.kt</span></span><br><span class="line"><span class="keyword">object</span> Net &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> PROP_BASE_URL = <span class="string">&quot;https://api.unsplash.com/&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> DEBUG_BASE_URL = <span class="string">&quot;https://api.unsplash.com/&quot;</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> BASE_URL <span class="keyword">get</span>() = DEBUG_BASE_URL</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">val</span> ACCESS_KEY = <span class="string">&quot;&lt;access_key unsplash.com&gt;&quot;</span> <span class="comment">// 注册https://api.unsplash.com/后拿到</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> retrofit: Retrofit <span class="keyword">by</span> lazy &#123;</span><br><span class="line">        <span class="keyword">val</span> okHttpClient = OkHttpClient.Builder()</span><br><span class="line">            .addInterceptor &#123; chain -&gt;</span><br><span class="line">                <span class="keyword">val</span> url = chain.request().url().newBuilder().addQueryParameter(<span class="string">&quot;client_id&quot;</span>, ACCESS_KEY).build()</span><br><span class="line">                <span class="keyword">val</span> request = chain.request().newBuilder().url(url).build()</span><br><span class="line">                chain.proceed(request)</span><br><span class="line">            &#125;.build()</span><br><span class="line"></span><br><span class="line">        Retrofit.Builder()</span><br><span class="line">            .baseUrl(BASE_URL)</span><br><span class="line">            .client(okHttpClient)</span><br><span class="line">            .addConverterFactory(GsonConverterFactory.create())</span><br><span class="line">            .build()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 处理网络回包</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// data/bean/Response.kt</span></span><br><span class="line"><span class="keyword">sealed</span> <span class="class"><span class="keyword">class</span> <span class="title">Response</span>&lt;<span class="type">out T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Success</span>&lt;<span class="type">T</span>&gt;</span>(<span class="keyword">val</span> <span class="keyword">data</span>: T) : Response&lt;T&gt;()</span><br><span class="line">    <span class="keyword">object</span> Failed : Response&lt;<span class="built_in">Nothing</span>&gt;()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 依赖注入</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// UnsplashApplication.kt</span></span><br><span class="line"><span class="meta">@HiltAndroidApp</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsplashApplication</span> : <span class="type">Application</span></span>() &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- AndroidManifest.xml --&gt;</span></span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">application</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:name</span>=<span class="string">&quot;.UnsplashApplication&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">...</span></span></span><br><span class="line"><span class="tag">        &gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="1-Model"><a href="#1-Model" class="headerlink" title="1. Model"></a>1. Model</h3><h4 id="data-bean"><a href="#data-bean" class="headerlink" title="data bean"></a>data bean</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// json 解析，变量名与json字段一致</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// data/bean/Photo.kt</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Photo</span></span>(</span><br><span class="line">    <span class="keyword">val</span> id: String,</span><br><span class="line">    <span class="keyword">val</span> created_at: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> updated_at: String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> urls: Urls,</span><br><span class="line">    <span class="keyword">val</span> likes: <span class="built_in">Long</span> = <span class="number">0</span>,</span><br><span class="line">    <span class="keyword">val</span> liked_by_user: <span class="built_in">Boolean</span> = <span class="literal">false</span>,</span><br><span class="line">    <span class="keyword">val</span> user: User,</span><br><span class="line">) &#123;</span><br><span class="line">    <span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">Urls</span></span>(</span><br><span class="line">        <span class="keyword">val</span> raw: String,</span><br><span class="line">        <span class="keyword">val</span> full: String,</span><br><span class="line">        <span class="keyword">val</span> regular: String,</span><br><span class="line">        <span class="keyword">val</span> small: String,</span><br><span class="line">        <span class="keyword">val</span> thumb: String,</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// data/bean/User.kt</span></span><br><span class="line"><span class="keyword">data</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>(</span><br><span class="line">    <span class="keyword">val</span> id:String,</span><br><span class="line">    <span class="keyword">val</span> updated_at:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> username:String=<span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> name:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> first_name:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">    <span class="keyword">val</span> last_name:String = <span class="string">&quot;&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h4 id="retrofit-interface"><a href="#retrofit-interface" class="headerlink" title="retrofit interface"></a>retrofit interface</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// retrofit 请求interface</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// data/api/UnsplashService.kt</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">UnsplashService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GET(<span class="meta-string">&quot;photos&quot;</span>)</span></span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">listPhotos</span><span class="params">()</span></span>: List&lt;Photo&gt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="service-module"><a href="#service-module" class="headerlink" title="service module"></a>service module</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// hilt 依赖注入，interface无法直接构造，需要通过Module和Provides指明构造方式</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// data/api/ServiceModule.kt</span></span><br><span class="line"><span class="meta">@Module</span></span><br><span class="line"><span class="meta">@InstallIn(ApplicationComponent::class)</span></span><br><span class="line"><span class="keyword">object</span> ServiceModule &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">inline</span> <span class="function"><span class="keyword">fun</span> <span class="type">&lt;<span class="keyword">reified</span> T&gt;</span> <span class="title">createService</span><span class="params">()</span></span>: T = Net.retrofit.create(T::<span class="keyword">class</span>.java)</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Singleton</span></span><br><span class="line">    <span class="meta">@Provides</span></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">unsplashService</span><span class="params">()</span></span>:UnsplashService = createService()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Model-UnsplashRepository"><a href="#Model-UnsplashRepository" class="headerlink" title="Model: UnsplashRepository"></a>Model: UnsplashRepository</h4><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// model层，提供数据</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// data/UnsplashRepository.kt</span></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UnsplashRepository</span> <span class="meta">@Inject</span> <span class="keyword">constructor</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> service: UnsplashService) &#123;</span><br><span class="line">    <span class="keyword">suspend</span> <span class="function"><span class="keyword">fun</span> <span class="title">listPhoto</span><span class="params">()</span></span> = <span class="keyword">try</span> &#123;</span><br><span class="line">        Response.Success(service.listPhotos())</span><br><span class="line">    &#125; <span class="keyword">catch</span> (_ : Exception)&#123;</span><br><span class="line">        Response.Failed</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-ViewModel"><a href="#2-ViewModel" class="headerlink" title="2. ViewModel"></a>2. ViewModel</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//viewmodels/ListPhotoViewModel.kt</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ListPhotoViewModel</span> <span class="meta">@ViewModelInject</span> <span class="keyword">constructor</span></span>(<span class="keyword">private</span> <span class="keyword">val</span> repository: UnsplashRepository) :</span><br><span class="line">    ViewModel() &#123;</span><br><span class="line">    <span class="keyword">val</span> listPhotos:MutableLiveData&lt;List&lt;Photo&gt;&gt; = MutableLiveData()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">refreshListPhotos</span><span class="params">()</span></span> = viewModelScope.launch &#123;</span><br><span class="line">        <span class="keyword">when</span>(<span class="keyword">val</span> res = repository.listPhoto())&#123;</span><br><span class="line">            <span class="keyword">is</span> Response.Success -&gt; listPhotos.value = res.<span class="keyword">data</span></span><br><span class="line">            <span class="keyword">is</span> Response.Failed -&gt; listPhotos.value = emptyList()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3-View"><a href="#3-View" class="headerlink" title="3. View"></a>3. View</h3><figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RecycleView, RefreshBottun, 暴力写法</span></span><br><span class="line"><span class="comment">// MainActivity.kt</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@AndroidEntryPoint</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> : <span class="type">AppCompatActivity</span></span>() &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">val</span> model: ListPhotoViewModel <span class="keyword">by</span> viewModels()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">init</span> &#123;</span><br><span class="line">        lifecycleScope.launchWhenCreated &#123;</span><br><span class="line">            model.refreshListPhotos()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreate</span><span class="params">(savedInstanceState: <span class="type">Bundle</span>?)</span></span> &#123;</span><br><span class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState)</span><br><span class="line">        setContentView(R.layout.activity_main)</span><br><span class="line"></span><br><span class="line">        refreshBtn.setOnClickListener &#123;</span><br><span class="line">            model.refreshListPhotos()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        photoList.layoutManager = GridLayoutManager(<span class="keyword">this</span>, <span class="number">2</span>)</span><br><span class="line">        model.listPhotos.observe(<span class="keyword">this</span>) &#123; photos -&gt;</span><br><span class="line">            photoList.adapter = <span class="keyword">object</span> : RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;() &#123;</span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onCreateViewHolder</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">                    parent: <span class="type">ViewGroup</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">                    viewType: <span class="type">Int</span></span></span></span><br><span class="line"><span class="params"><span class="function">                )</span></span>: RecyclerView.ViewHolder = <span class="keyword">object</span> : RecyclerView.ViewHolder(</span><br><span class="line">                    ImageView(parent.context)</span><br><span class="line">                ) &#123;&#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">onBindViewHolder</span><span class="params">(holder: <span class="type">RecyclerView</span>.<span class="type">ViewHolder</span>, position: <span class="type">Int</span>)</span></span> &#123;</span><br><span class="line">                    <span class="keyword">val</span> photo = photos[position]</span><br><span class="line"></span><br><span class="line">                    with(holder.itemView <span class="keyword">as</span> ImageView) &#123;</span><br><span class="line">                        Glide.with(<span class="keyword">this</span>).load(photo.urls.raw).into(<span class="keyword">this</span>)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">override</span> <span class="function"><span class="keyword">fun</span> <span class="title">getItemCount</span><span class="params">()</span></span>: <span class="built_in">Int</span> = photos.size</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
            </article>
        </div>

        <div class="col"></div>
    </div>
</div>
    <footer class="h-25"> footer </footer>
</body>

</html>