<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1">

    
<link rel="stylesheet" href="/blog-theme/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/blog-theme/css/global.css">

    
<link rel="stylesheet" href="/blog-theme/css/article.css">

    
    
<script src="/blog-theme/bootstrap/js/bootstrap.bundle.min.js"></script>


    <title>
        I&#39;m prime
    </title>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="bg-dark">
    <header>
    <nav class="navbar navbar-expand navbar-expand-lg navbar-dark sticky-top shadow">
        <div class="container-fluid">
            <a class="navbar-brand" href="/blog-theme/">

                

            I&#39;m prime
            </a>

            <div class="collapse navbar-collapse justify-content-end" id="navbarNavDropdown">
                <ul class="navbar-nav">

                    

                        <li class="nav-item">
                            <a class="nav-link " aria-current="page"
                                href="/blog-theme/">
                                主页
                            </a>
                        </li>

                    

                        <li class="nav-item">
                            <a class="nav-link " aria-current="page"
                                href="/blog-theme/archives/">
                                归档
                            </a>
                        </li>

                    

                </ul>
            </div>
        </div>
    </nav>
</header>
    <div class="container-fluid mt-md-5">
    <div class="row">
        <div class="col"></div>
        <div class="col-12 col-sm-10 col-md-8 col-lg-7 col-xl-5 shadow-lg">
            <div class="container-fluid mt-5 text-center">
                <h1 class="text-white">
                    188. 买卖股票的最佳时机 IV (每日一题)
                </h1>
                <p class="mt-2 text-secondary">
                    2020.12.28
                </p>
            </div>

            <article class="container-fluid text-white">
                <h2 id="leetcode-笔记"><a href="#leetcode-笔记" class="headerlink" title="leetcode 笔记"></a><a href="https://lzyprime.github.io/leetcode/leetcode">leetcode 笔记</a></h2><hr>
<h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>给定一个整数数组 prices ，它的第 i 个元素 prices[i] 是一支给定的股票在第 i 天的价格。</p>
<p>设计一个算法来计算你所能获取的最大利润。你最多可以完成 k 笔交易。</p>
<p>注意：你不能同时参与多笔交易（你必须在再次购买前出售掉之前的股票）。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">示例 <span class="number">1</span>：</span><br><span class="line"></span><br><span class="line">输入：k = <span class="number">2</span>, prices = [<span class="number">2</span>,<span class="number">4</span>,<span class="number">1</span>]</span><br><span class="line">输出：<span class="number">2</span></span><br><span class="line">解释：在第 <span class="number">1</span> 天 (股票价格 = <span class="number">2</span>) 的时候买入，在第 <span class="number">2</span> 天 (股票价格 = <span class="number">4</span>) 的时候卖出，这笔交易所能获得利润 = <span class="number">4</span><span class="number">-2</span> = <span class="number">2</span> 。</span><br><span class="line">示例 <span class="number">2</span>：</span><br><span class="line"></span><br><span class="line">输入：k = <span class="number">2</span>, prices = [<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>]</span><br><span class="line">输出：<span class="number">7</span></span><br><span class="line">解释：在第 <span class="number">2</span> 天 (股票价格 = <span class="number">2</span>) 的时候买入，在第 <span class="number">3</span> 天 (股票价格 = <span class="number">6</span>) 的时候卖出, 这笔交易所能获得利润 = <span class="number">6</span><span class="number">-2</span> = <span class="number">4</span> 。</span><br><span class="line">     随后，在第 <span class="number">5</span> 天 (股票价格 = <span class="number">0</span>) 的时候买入，在第 <span class="number">6</span> 天 (股票价格 = <span class="number">3</span>) 的时候卖出, 这笔交易所能获得利润 = <span class="number">3</span><span class="number">-0</span> = <span class="number">3</span> 。</span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">提示：</span><br><span class="line"><span class="number">0</span> &lt;= k &lt;= <span class="number">10</span>^<span class="number">9</span></span><br><span class="line"><span class="number">0</span> &lt;= prices.length &lt;= <span class="number">1000</span></span><br><span class="line"><span class="number">0</span> &lt;= prices[i] &lt;= <span class="number">1000</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>来源：力扣（LeetCode）<br>链接：<a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv">https://leetcode-cn.com/problems/best-time-to-buy-and-sell-stock-iv</a><br>著作权归领扣网络所有。商业转载请联系官方授权，非商业转载请注明出处。</p>
</blockquote>
<h2 id="code"><a href="#code" class="headerlink" title="code"></a>code</h2><ul>
<li><h3 id="c"><a href="#c" class="headerlink" title="c++"></a>c++</h3></li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="keyword">int</span> k, vector&lt;<span class="keyword">int</span>&gt; &amp;prices)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> size = prices.<span class="built_in">size</span>();</span><br><span class="line">        <span class="keyword">if</span> (size &lt; <span class="number">2</span> || k == <span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        k = <span class="built_in">min</span>(k, size / <span class="number">2</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">b</span><span class="params">(k + <span class="number">1</span>, <span class="number">-1000</span>)</span>, <span class="title">s</span><span class="params">(k + <span class="number">1</span>, <span class="number">0</span>)</span></span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> v : prices)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= k; ++j)</span><br><span class="line">            &#123;</span><br><span class="line">                b[j] = <span class="built_in">max</span>(b[j], s[j - <span class="number">1</span>] - v);</span><br><span class="line">                s[j] = <span class="built_in">max</span>(s[j], b[j] + v);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> s.<span class="built_in">back</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>拆解：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 最多可做的交易数</span></span><br><span class="line">k = <span class="built_in">min</span>(k, size / <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> v : prices)&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// i - 1天过后，每笔交易完成后的最优解</span></span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; pre = s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= k; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// b[j] 存第 j 笔交易买入后的结果</span></span><br><span class="line">        <span class="comment">// 所以如果买第i天的股票。则可获得的金额为: 当前第j - 1笔交易完成后的结果pre[j - 1] - 股票价格</span></span><br><span class="line">        <span class="comment">// 与当前的购买方案比较留下最优解。</span></span><br><span class="line">        <span class="comment">// 由于此时s[j - 1]并没有任何修改，pre[j - 1] == s[j - 1]</span></span><br><span class="line">        b[j] = <span class="built_in">max</span>(b[j], pre[j - <span class="number">1</span>] - v);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// s[j] 存第 j 笔交易完成时的结果</span></span><br><span class="line">        <span class="comment">// 如果按第 i 天价格卖出，则可获得的金额为: 当前第j笔交易买入后的结果b[j] + 股票价格</span></span><br><span class="line">        <span class="comment">// 与当前卖出方案留最优解。</span></span><br><span class="line">        <span class="comment">// 同上，由于此时s[j]并没有任何修改，pre[j] == s[j], 所以pre数组可以免掉</span></span><br><span class="line">        s[j] = <span class="built_in">max</span>(pre[j], b[j] + v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="kotlin"><a href="#kotlin" class="headerlink" title="kotlin"></a>kotlin</h3></li>
</ul>
<p>一刀流，没意义。 涉及下标访问的，函数式都差点意思。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">fun</span> <span class="title">maxProfit</span><span class="params">(k: <span class="type">Int</span>, prices: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Int</span> = prices.fold(Array(min(k, prices.size / <span class="number">2</span>) + <span class="number">1</span>) &#123; -<span class="number">1000</span> to <span class="number">0</span> &#125;) &#123; arr, v -&gt; arr.apply &#123; (<span class="number">1.</span>.arr.lastIndex).forEach &#123; i -&gt; arr[i] = max(arr[i].first, arr[i - <span class="number">1</span>].second - v) to max(arr[i].second, arr[i].first + v) &#125; &#125; &#125;.last().second</span><br></pre></td></tr></table></figure>

<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> kotlin.math.min</span><br><span class="line"><span class="keyword">import</span> kotlin.math.max</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">fun</span> <span class="title">maxProfit</span><span class="params">(k: <span class="type">Int</span>, prices: <span class="type">IntArray</span>)</span></span>: <span class="built_in">Int</span> = prices.fold(</span><br><span class="line">        Array(</span><br><span class="line">            min(</span><br><span class="line">                k,</span><br><span class="line">                prices.size / <span class="number">2</span></span><br><span class="line">            ) + <span class="number">1</span></span><br><span class="line">        ) &#123; -<span class="number">1000</span> to <span class="number">0</span> &#125;) &#123; arr, v -&gt;</span><br><span class="line">        arr.apply &#123;</span><br><span class="line">            (<span class="number">1.</span>.arr.lastIndex).forEach &#123; i -&gt;</span><br><span class="line">                arr[i] = max(arr[i].first, arr[i - <span class="number">1</span>].second - v) to max(arr[i].second, arr[i].first + v)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;.last().second</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<ul>
<li><h3 id="scala"><a href="#scala" class="headerlink" title="scala"></a>scala</h3></li>
</ul>
<p>一刀流</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span></span>(k: <span class="type">Int</span>, prices: <span class="type">Array</span>[<span class="type">Int</span>]): <span class="type">Int</span> = prices.foldLeft(<span class="type">Array</span>.fill(math.min(k, prices.length / <span class="number">2</span>) + <span class="number">1</span>)(<span class="number">-1000</span> -&gt; <span class="number">0</span>)) &#123; (acc, v) =&gt; (<span class="number">1</span> until acc.length).foreach(i =&gt; acc(i) = math.max(acc(i)._1, acc(i - <span class="number">1</span>)._2 - v) -&gt; math.max(acc(i)._2, acc(i)._1 + v)); acc &#125;.last._2</span><br></pre></td></tr></table></figure>

<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">maxProfit</span></span>(k: <span class="type">Int</span>, prices: <span class="type">Array</span>[<span class="type">Int</span>]): <span class="type">Int</span> =</span><br><span class="line">    prices.foldLeft(<span class="type">Array</span>.fill(math.min(k, prices.length / <span class="number">2</span>) + <span class="number">1</span>)(<span class="number">-1000</span> -&gt; <span class="number">0</span>)) &#123; (acc, v) =&gt;</span><br><span class="line">      (<span class="number">1</span> until acc.length).foreach(i =&gt;</span><br><span class="line">        acc(i) = math.max(acc(i)._1, acc(i - <span class="number">1</span>)._2 - v) -&gt; math.max(acc(i)._2, acc(i)._1 + v))</span><br><span class="line">      acc</span><br><span class="line">    &#125;.last._2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><h3 id="rust"><a href="#rust" class="headerlink" title="rust"></a>rust</h3></li>
</ul>
<p>一刀流</p>
<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">max_profit</span></span>(k: <span class="built_in">i32</span>, prices: <span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt;) -&gt; <span class="built_in">i32</span> &#123;prices.iter().fold(<span class="built_in">vec!</span>[(-<span class="number">1000</span>, <span class="number">0</span>); (k <span class="keyword">as</span> <span class="built_in">usize</span>).min(prices.len() / <span class="number">2</span>) + <span class="number">1</span>],|<span class="keyword">mut</span> acc, v| &#123;(<span class="number">1</span>..acc.len()).for_each(|i| acc[i] = (acc[i].<span class="number">0</span>.max(acc[i - <span class="number">1</span>].<span class="number">1</span> - v), acc[i].<span class="number">1</span>.max(acc[i].<span class="number">0</span> + v)));acc&#125;,).last().unwrap().<span class="number">1</span>&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">impl</span> Solution &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">max_profit</span></span>(k: <span class="built_in">i32</span>, prices: <span class="built_in">Vec</span>&lt;<span class="built_in">i32</span>&gt;) -&gt; <span class="built_in">i32</span> &#123;</span><br><span class="line">        prices</span><br><span class="line">            .iter()</span><br><span class="line">            .fold(</span><br><span class="line">                <span class="built_in">vec!</span>[(-<span class="number">1000</span>, <span class="number">0</span>); (k <span class="keyword">as</span> <span class="built_in">usize</span>).min(prices.len() / <span class="number">2</span>) + <span class="number">1</span>],</span><br><span class="line">                |<span class="keyword">mut</span> acc, v| &#123;</span><br><span class="line">                    (<span class="number">1</span>..acc.len()).for_each(|i| &#123;</span><br><span class="line">                        acc[i] = (acc[i].<span class="number">0</span>.max(acc[i - <span class="number">1</span>].<span class="number">1</span> - v), acc[i].<span class="number">1</span>.max(acc[i].<span class="number">0</span> + v))</span><br><span class="line">                    &#125;);</span><br><span class="line">                    acc</span><br><span class="line">                &#125;,</span><br><span class="line">            )</span><br><span class="line">            .last()</span><br><span class="line">            .unwrap()</span><br><span class="line">            .<span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

            </article>
        </div>

        <div class="col"></div>
    </div>
</div>
    <footer class="h-25"> footer </footer>
</body>

</html>